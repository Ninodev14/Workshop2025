<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salle d'attente</title>
</head>

<body>
    <h1>Salle d'attente</h1>
    <p>En attente de joueurs...</p>

    <ul id="player-list"></ul>

    <button id="start-game" style="display: none;">Lancer la partie</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const urlParams = new URLSearchParams(window.location.search);
        const roomId = urlParams.get('roomId');
        const playerName = localStorage.getItem('playerName');

        if (!roomId || !playerName) {
            alert("Erreur : Room ou nom invalide.");
            window.location.href = "index.html";
        }

        // Rejoindre la room
        socket.emit('joinRoom', roomId, playerName, (response) => {
            if (!response.success) {
                alert(response.message);
                window.location.href = "index.html";
            }
        });

        // Mise à jour de la liste des joueurs
        socket.on('updatePlayers', (players) => {
            const playerList = document.getElementById("player-list");
            playerList.innerHTML = '';

            players.forEach(player => {
                const li = document.createElement("li");
                li.textContent = player.name;
                playerList.appendChild(li);
            });

            // Afficher le bouton "Lancer la partie" seulement si l'utilisateur est l'hôte
            if (players.length > 1 && players[0].id === socket.id) {
                document.getElementById("start-game").style.display = "block";
            }
        });

        // Lancer la partie
        document.getElementById("start-game").addEventListener("click", () => {
            socket.emit("startGame", roomId);
        });

        // Redirection lorsque la partie démarre
        socket.on("gameStarted", () => {
            window.location.href = `game.html?roomId=${roomId}`;
        });
    </script>
</body>

</html>